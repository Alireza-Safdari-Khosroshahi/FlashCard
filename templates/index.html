<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard App</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="notification-area"></div>

    <div id="app-wrapper">
        <div id="sidebar">
            <div class="sidebar-header">
                {% if current_user.is_authenticated %}
                    <span class="user-info">Welcome, {{ current_user.name }}!</span>
                    <a href="{{ url_for('logout') }}" class="btn btn-secondary logout-button">Logout</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn btn-primary login-button">Login with Google</a>
                {% endif %}
            </div>
            <div class="tabs">
                <button class="tab-button active" onclick="openTab('decks')">Decks</button>
                <button class="tab-button" onclick="openTab('learning')">Learning</button>
                <button class="tab-button" onclick="openTab('manage-cards')">Manage Cards</button>
                <button class="tab-button" onclick="openTab('quiz-mode')">Quiz Mode</button>
                <button class="tab-button" onclick="openTab('ai-tools')">AI Tools</button>
                <button class="tab-button" onclick="openTab('settings')">Settings</button>
            </div>
        </div>

        <div id="main-content">
            <button id="mobile-menu-button" class="btn btn-secondary">â˜°</button>
            {% if current_user.is_authenticated or disable_google_login %}
            <div id="delete-confirm-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <p>Are you sure you want to delete this card?</p>
                    <div class="modal-actions">
                        <button id="confirm-delete-btn" class="btn btn-danger">Delete</button>
                        <button id="cancel-delete-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="edit-card-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <h3>Edit Card</h3>
                    <form id="edit-card-form">
                        <input type="hidden" id="edit-card-id">
                        <div class="form-group">
                            <label for="edit-question">Question</label>
                            <textarea id="edit-question" class="form-control" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="edit-answer">Answer</label>
                            <textarea id="edit-answer" class="form-control" required></textarea>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="container">
                <div id="decks" class="tab-content active">
                    <h2>Decks</h2>
                    <div id="deck-list-container">
                        <ul id="deck-list"></ul>
                    </div>
                    <div id="add-deck-container">
                        <h3>Create a New Deck</h3>
                        <form id="add-deck-form">
                            <input type="text" id="deck-name" class="form-control" placeholder="Deck Name" required>
                            <button type="submit" class="btn btn-primary">Create Deck</button>
                        </form>
                    </div>
                </div>

                <div id="learning" class="tab-content">
                    <h2>Learning</h2>
                    <select id="learning-deck-select" class="form-control"></select>
                    <button id="start-learning-button" class="btn btn-primary">Start Learning</button>
                    <div id="deck-stats-container" style="display: none; margin-top: 20px;">
                        <h3>Deck Statistics</h3>
                        <div id="deck-stats"></div>
                        <div style="width: 50%; margin: auto;">
                            <canvas id="deck-chart"></canvas>
                        </div>
                    </div>
                    <div id="learning-container" style="display: none;">
                        <div id="learning-progress-bar-container">
                            <span id="remaining-cards-count">Remaining: 0</span> |
                            <span id="again-cards-count">Again: 0</span> |
                            <span id="good-cards-count">Good: 0</span> |
                            <span id="easy-cards-count">Easy: 0</span>
                        </div>
                        <div id="learning-card">
                            <div class="card-block" id="question-block">
                                <p id="learning-question"></p>
                                <button class="speak-button btn btn-secondary btn-sm" data-target-id="learning-question" title="Speak Question">ðŸ”Š</button>
                            </div>
                            <div class="card-block" id="answer-block" style="display: none;">
                                <p id="learning-answer"></p>
                                <button class="speak-button btn btn-secondary btn-sm" data-target-id="learning-answer" title="Speak Answer">ðŸ”Š</button>
                            </div>
                        </div>
                        <button id="show-answer-button" class="btn btn-primary">Show Answer</button>
                        <div id="rating-buttons" style="display: none;">
                            <button onclick="rateCard('again')" class="btn btn-danger">Again</button>
                            <button onclick="rateCard('good')" class="btn btn-warning">Good</button>
                            <button onclick="rateCard('easy')" class="btn btn-success">Easy</button>
                        </div>
                    </div>
                </div>

                <div id="manage-cards" class="tab-content">
                    <h2>Manage Flashcards</h2>
                    <div class="manage-cards-container">
                        <div class="manage-cards-forms">
                            <div id="add-card-container">
                                <h3>Add a New Card</h3>
                                <form id="add-card-form">
                                    <div class="form-group">
                                        <label for="deck-select">Select Deck:</label>
                                        <select id="deck-select" class="form-control"></select>
                                    </div>
                                    <div class="form-group">
                                        <label for="question">Question:</label>
                                        <textarea id="question" class="form-control" placeholder="Question" required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="answer">Answer:</label>
                                        <textarea id="answer" class="form-control" placeholder="Answer" required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Add Card</button>
                                </form>
                            </div>

                            <div id="import-cards-container">
                                <h3>Import Cards from JSON</h3>
                                <form id="import-cards-form">
                                    <div class="form-group">
                                        <label for="import-deck-select">Select Deck:</label>
                                        <select id="import-deck-select" class="form-control"></select>
                                    </div>
                                    <div class="input-group">
                                        <input type="file" id="import-file" class="form-control" accept=".json">
                                        <button id="import-button" type="button" class="btn btn-primary">Import</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="manage-cards-list">
                            <h3>Your Cards</h3>
                            <ul id="card-list"></ul>
                        </div>
                    </div>
                </div>

                <div id="quiz-mode" class="tab-content">
                    <h2>Quiz Mode</h2>
                    <div id="quiz-setup">
                        <div class="form-group">
                            <label for="quiz-deck-select">Select Deck:</label>
                            <select id="quiz-deck-select" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <label>Quiz Type:</label>
                            <input type="radio" id="quiz-type-mc" name="quiz-type" value="multiple-choice" checked>
                            <label for="quiz-type-mc">Multiple Choice</label>
                            <input type="radio" id="quiz-type-la" name="quiz-type" value="long-answer">
                            <label for="quiz-type-la">Long Answer</label>
                        </div>
                        <div class="input-group">
                            <button id="start-quiz-button" class="btn btn-primary">Start Quiz</button>
                            <button id="generate-quiz-from-flashcards-button" class="btn btn-primary">Generate Quiz from AI</button>
                        </div>
                    </div>
                    <div id="quiz-container" style="display: none;">
                        <div id="progress-bar-container">
                            <div id="progress-bar"></div>
                        </div>
                        <div class="quiz-card">
                            <p id="question-display"></p>
                            <div id="answer-options"></div>
                            <input type="text" id="answer-input" class="form-control" placeholder="Your answer">
                            <button id="submit-answer-button" class="btn btn-primary">Submit Answer</button>
                            <p id="feedback"></p>
                        </div>
                        <button id="next-question-button" class="btn btn-success" style="display: none;">Next Question</button>
                    </div>
                    <div id="ai-log-container" style="display: none;">
                        <h3>AI Generation Log</h3>
                        <pre id="ai-log"></pre>
                    </div>
                </div>

                <div id="ai-tools" class="tab-content">
                    <h2>AI Tools</h2>
                    <div id="generate-cards-container">
                        <h3>Generate Flashcards from Topic</h3>
                        <form id="generate-cards-form">
                            <div class="form-group">
                                <label for="ai-deck-select">Select Deck:</label>
                                <select id="ai-deck-select" class="form-control"></select>
                            </div>
                            <div class="input-group">
                                <input type="text" id="topic-input" class="form-control" placeholder="Enter a topic" required>
                                <button type="submit" class="btn btn-primary">Generate Cards</button>
                            </div>
                        </form>
                    </div>

                    <div id="create-quiz-container">
                        <h3>Create Quiz from PDF</h3>
                        <form id="create-quiz-form">
                            <div class="input-group">
                                <input type="file" id="pdf-file-input" class="form-control" accept=".pdf" required>
                                <button type="submit" class="btn btn-primary">Create Quiz</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <h2>Settings</h2>
                    <form id="settings-form">
                        <div class="form-group">
                            <label for="quiz_questions">Number of questions in quiz:</label>
                            <input type="number" id="quiz_questions" class="form-control" name="quiz_questions">
                        </div>
                        <div class="form-group">
                            <label for="new_cards_per_day">New Cards Per Day:</label>
                            <input type="number" id="new_cards_per_day" class="form-control" name="new_cards_per_day">
                        </div>
                        <div class="form-group">
                            <label for="gemini_api_key">Gemini API Key:</label>
                            <input type="password" id="gemini_api_key" class="form-control" name="gemini_api_key">
                        </div>
                        <div class="form-group">
                            <label for="gemini_model">Gemini Model:</label>
                            <input type="text" id="gemini_model" class="form-control" name="gemini_model">
                        </div>
                        <div class="form-group">
                            <label for="question_language">Question Language (e.g., en-US, fa-IR):</label>
                            <input type="text" id="question_language" class="form-control" name="question_language">
                        </div>
                        <div class="form-group">
                            <label for="answer_language">Answer Language (e.g., en-US, fa-IR):</label>
                            <input type="text" id="answer_language" class="form-control" name="answer_language">
                        </div>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="disable_google_login" name="disable_google_login">
                            <label class="form-check-label" for="disable_google_login">Disable Google Login</label>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>
            </div> {# Close container #}
            {% else %}
                {% if not disable_google_login %}
                <div class="container">
                    <p>Please log in to use the Flashcard App.</p>
                </div>
                {% endif %}
            {% endif %}
        </div> {# Close main-content #}
    </div> {# Close app-wrapper #}

    <script src="/static/js/script.js"></script>
</body>
</html>